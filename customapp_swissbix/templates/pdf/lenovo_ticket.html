<!doctype html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Ricevuta Assistenza Lenovo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        font-size: 12px;
        color: #333;
        line-height: 1.4;
      }
      .container {
        width: 100%;
        padding: 20px;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        border-bottom: 2px solid #e2231a;
        padding-bottom: 10px;
      }
      .logo {
        height: 50px;
      }
      .title {
        font-size: 24px;
        font-weight: bold;
        color: #e2231a;
        text-align: right;
      }
      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      /* Sub-header line */
      .sub-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 4mm;
      }
      .doc-title {
        font-weight: bold;
        font-size: 14px;
      }
      .doc-ref {
        border-bottom: 1px solid #000;
        width: 200px;
      }

      /* Sections */
      .section-header {
        background-color: #808080; /* Gray background */
        color: #fff;
        padding: 4px 8px;
        font-weight: bold;
        margin-bottom: 4px;
        font-size: 11px;
      }
      
      .row {
        display: flex;
        margin-bottom: 8px;
        border-bottom: 1px solid #000; /* Underline fields */
        padding-bottom: 2px;
      }
      .col {
        flex: 1;
        padding-right: 10px;
      }
      .label {
        font-weight: bold;
        display: block;
        font-size: 10px;
        color: #333;
        margin-bottom: 2px;
      }
      .value {
        display: block;
        min-height: 14px;
      }

      /* Specific widths to match image approx */
      .w-40 { width: 40%; }
      .w-30 { width: 30%; }
      .w-20 { width: 20%; }
      
      /* Checkboxes */
      .checkbox-group {
        display: flex;
        gap: 15px;
      }
      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .box {
        width: 12px;
        height: 12px;
        border: 1px solid #000;
        display: inline-block;
        text-align: center;
        line-height: 10px;
        font-size: 10px;
        padding-top: 5px;
      }

    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header-container">
      <div style="display: flex; align-items:center; justify-content: space-between; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 5px;">
        {% if logoUrl %}
        <img src="{{ logoUrl }}" class="logo" alt="Lenovo" />
        {% else %}
        <div style="font-size: 30px; font-weight: bold; color: #E2231A;">Lenovo</div>
        {% endif %}
        
        <!-- Placeholder for Service Provider Logo if needed -->
        <img src="{{ certificateUrl }}" style="height: 50px;" />
        <div style="font-size: 24px; font-weight: bold;">IT Work Order</div>
      </div>
    </div>

    <!-- Sub-Header -->
    <div class="sub-header">
      <div class="doc-title">Ordine di Riparazione / Intervento</div>
      <div>
        Boll. No. <span class="doc-ref">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
      </div>
    </div>

    <!-- Dati Cliente -->
    <div class="section-header">Dati Cliente</div>
    <div class="row">
      <div class="col w-40">
        <span class="label">Ditta / Cognome</span>
        <span class="value">{{ company_name|default:surname }}</span>
      </div>
      <div class="col w-30">
        <span class="label">Nome</span>
        <span class="value">{{ name }}</span>
      </div>
      <div class="col w-30">
        <span class="label">Tel./Mobile</span>
        <span class="value">{{ phone }}</span>
      </div>
    </div>
    
    <div class="row">
      <div class="col w-40">
        <span class="label">Indirizzo</span>
        <span class="value">{{ address }}</span>
      </div>
      <div class="col w-30">
        <span class="label">Luogo</span>
        <span class="value">{{ place }}</span>
      </div>
      <div class="col w-30">
        <span class="label">Email</span>
        <span class="value">{{ email }}</span>
      </div>
    </div>

    <!-- Dati Riparazione -->
    <div class="section-header" style="margin-top: 10px;">Dati Riparazione</div>
    <div class="row" style="border-bottom: 2px solid #000;">
      <div class="col w-20">
        <span class="label">Marca</span>
        <span class="value">{{ brand }}</span>
      </div>
      <div class="col w-30">
        <span class="label">Modello</span>
        <span class="value">{{ model }} (SN: {{ serial }})</span>
      </div>
      <div class="col w-30">
        <span class="label">Utente / Password</span>
        <span class="value">{{ username }} / {{ password }}</span>
      </div>
    </div>

    <!-- Spacer for content below -->
    <div style="margin-top: 20px;"></div>

    <!-- Images / Description / Signature (Keep previous detailed content but simplified/styled if needed) -->
    
    <!-- Photos Section (Central) -->
    <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 20px; height: 300px;">
        <!-- Product Photo -->
        <div style="flex: 1; border: 1px solid #ccc; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative;">
            {% if product_photo_b64 %}
                <img src="{{ product_photo_b64 }}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
            {% else %}
                <div style="color: #ccc;">FOTO PRODOTTO</div>
            {% endif %}
        </div>

        <!-- Attachments / Damage Diagram -->
        <div style="flex: 1; border: 1px solid #ccc; padding: 5px; overflow: hidden; position: relative;">
             {% if attachments %}
                <div style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; align-items: flex-start; height: 100%; overflow: hidden;">
                    {% for att in attachments %}
                        <div style="text-align: center;">
                            <img src="{{ att.image }}" style="max-width: 100%; max-height: 100px; object-fit: contain; border: 1px solid #eee;" />
                            {% if att.note %}
                                <div style="font-size: 8px; color: #555; margin-top: 2px;">{{ att.note }}</div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
             {% else %}
                 <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #ccc;">
                    DIAGRAMMA DANNI / ALLEGATI
                 </div>
             {% endif %}
        </div>
    </div>

    <!-- Description -->
    <div style="margin-bottom: 20px;">
        <div class="section-header">Descrizione Problema / Lavori da Eseguire</div>
        <div style="border: 1px solid #000; height: 100px; padding: 10px;">
            {{ problem_description|linebreaksbr }}
        </div>
    </div>

    <!-- Authorization Checkboxes (Top Group) -->
    <div style="font-size: 10px; margin-bottom: 15px;">
        <div class="checkbox-item " style="margin-bottom: 5px">
           <div class="box">{% if auth_factory_reset == 'Si' %}X{% endif %}</div>
           In caso di necessita per il ripristino del sistema ed il corretto funzionamento, autorizzo il ripristino alle impostazioni di Fabbrica. In questo caso verr√° automaticamente aggiunto il servizio Backup/Ripristino ove possibile.
        </div>

        <div class="checkbox-item " style="margin-bottom: 5px">
            <div class="box">{% if request_quote == 'Si' %}X{% endif %}</div>
            Desidero ricevere un Preventivo, riconosco che in caso di mancata riparazione, le spese di valutazione del problema ammontano al massimo a fr. 50.--.
         </div>

         <div class="checkbox-item " style="margin-bottom: 5px">
            <div class="box">{% if direct_repair == 'Si' %}X{% endif %}</div>
            Procedere direttamente alla riparazione, se i costi non superano i Fr. <span style="border-bottom: 1px solid #000; min-width: 50px; display: inline-block;">{{ direct_repair_limit|default:"_______" }}</span>
         </div>
    </div>

    <!-- Intervento Diretto -->
    <div class="section-header">Intervento Diretto</div>
    <div style="font-size: 10px; margin-bottom: 15px;">
         <div class="checkbox-item " style="margin-bottom: 5px">
            <div class="box">{% if auth_formatting == 'Si' %}X{% endif %}</div>
            Autorizzo la Formattazione completa del Sistema. Ho effettuato i backup oppure ho ordinato il servizio di Backup supplementare.
         </div>
    </div>

    <!-- Informazioni Aggiuntive -->
    <div class="section-header">Informazioni Aggiuntive</div>
    <div style="font-size: 10px; margin-bottom: 20px;">
        <div style="margin-bottom: 8px;"><strong>Lenovo Repair Number:</strong></div>
        
        <div style="display: flex; gap: 50px;">
            <div>
                <strong>Prodotto in garanzia:</strong> 
                [{% if warranty == 'Si' %}X{% else %}&nbsp;{% endif %}] Si 
                [{% if warranty == 'No' or not warranty %}X{% else %}&nbsp;{% endif %}] No
            </div>
            <div>
                <strong>Tipologia garanzia:</strong> {{ warranty_type }}
            </div>
        </div>
    </div>
    
    <!-- Signatures Breakdown -->
    <div style="display: flex; justify-content: space-between; margin-top: 30px; page-break-inside: avoid;">
        <!-- Left Column: Delivered -->
        <div style="width: 48%;">
            <div style="font-weight: bold; font-size: 11px; margin-bottom: 10px;">Consegnato a Swissbix il:</div>
            
            <div style="margin-bottom: 25px;">
                <div style="font-weight: bold; font-size: 10px;">Data/Luogo</div>
                <div style="border-bottom: 1px solid #000; height: 16px; margin-top: 10px;"></div>
            </div>

            <div>
                <div style="font-weight: bold; font-size: 10px;">Firma</div>
                <div style="border-bottom: 1px solid #000; height: 30px; margin-top: 10px;"></div>
            </div>
        </div>

        <!-- Right Column: Picked Up -->
        <div style="width: 48%;">
            <div style="font-weight: bold; font-size: 11px; margin-bottom: 10px;">Ritirato il:</div>
            
            <div style="margin-bottom: 25px;">
                <div style="font-weight: bold; font-size: 10px;">Data/Luogo</div>
                <div style="border-bottom: 1px solid #000; margin-top: 10px;">Massagno, {{ reception_date }}</div>
            </div>

            <div>
                <div style="font-weight: bold; font-size: 10px;">Firma</div>
                {% if signatureUrl %}
                    <img src="{{ signatureUrl }}" style="height: 40px; border-bottom: 1px solid #000; width: 100%; object-fit: contain; object-position: left bottom;" />
                {% else %}
                    <div style="border-bottom: 1px solid #000; height: 30px; margin-top: 10px;"></div>
                {% endif %}
            </div>
        </div>
    </div>

  </body>
</html>
